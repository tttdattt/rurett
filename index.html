<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>„Ç∑„É≥„Éó„É´„É´„Éº„É¨„ÉÉ„Éà</title>
<style>
:root{
  --bg:#f2f2f7;
  --card:#fff;
  --text:#000;
  --button:#e8e8eb;
  --button-hover:#e0e0e4;
  --operator:#ff9500;
  --operator-shadow:rgba(255, 149, 0, 0.1);
  --border:rgba(0,0,0,0.03);
  --shadow-soft: 0 20px 60px rgba(0,0,0,0.03), 0 4px 12px rgba(0,0,0,0.01);
}
body.dark{
  --bg:#050505;
  --card:#121214;
  --text:#fff;
  --button:#1c1c1e;
  --button-hover:#2c2c2e;
  --operator:#ff9f0a;
  --operator-shadow:rgba(255, 159, 10, 0.15);
  --border:rgba(255,255,255,0.04);
  --shadow-soft: 0 30px 80px rgba(0,0,0,0.5);
}
*{box-sizing:border-box}
body{
  margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
  background:var(--bg); color:var(--text); transition: background .3s;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  overflow-x: hidden;
}

.main-wrapper {
  display: flex; align-items: stretch; justify-content: center;
  gap: 24px; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  max-width: 98vw;
}

.container {
  width: 720px; background: var(--card); border-radius: 36px;
  padding: 48px; box-shadow: var(--shadow-soft);
  display: flex; flex-direction: column; align-items: center; gap: 32px;
  position: relative;
}

.settings-panel {
  width: 0; opacity: 0; background: var(--card); border-radius: 36px;
  box-shadow: var(--shadow-soft); transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex; flex-direction: column; overflow: hidden; pointer-events: none;
  transform: translateX(20px);
}
.settings-panel.open {
  width: 360px; opacity: 1; padding: 40px; pointer-events: auto; transform: translateX(0);
}

.roulette-wrapper { position: relative; width: 420px; height: 420px; }
#canvas { width: 100%; height: 100%; }

.pointer {
  position: absolute; top: -14px; left: 50%; transform: translateX(-50%);
  width: 38px; height: 48px;
  background: linear-gradient(135deg, #ff3b30, #ff9f0a, #ffcc00, #34c759, #007aff, #5856d6, #af52de);
  clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 10;
}

.top-buttons { position: fixed; top: 24px; right: 24px; display:flex; gap:12px; z-index:2000; }
.top-btn {
  background:var(--button); border:none; padding:12px 20px; border-radius:16px;
  cursor:pointer; color:var(--text); transition: all 0.2s; font-weight: 600;
}
.top-btn:hover { background:var(--button-hover); }

.spin-btn {
  background: var(--operator); color: #fff; border: none; padding: 20px 90px;
  border-radius: 45px; font-size: 1.5rem; font-weight: bold; cursor: pointer;
  transition: all 0.3s; box-shadow: 0 10px 30px var(--operator-shadow);
}
.spin-btn:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 15px 40px var(--operator-shadow); }
.spin-btn:disabled { opacity: 0.5; }

#result-display { font-size: 2.6rem; font-weight: 900; color: var(--operator); min-height: 3.5rem; letter-spacing: -1px; }

.item-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 14px; margin: 24px 0; }
.item-row { display: flex; gap: 10px; align-items: center; }
.item-row input { background: var(--bg); border: 1px solid var(--border); padding: 12px; border-radius: 12px; color: var(--text); outline: none; width: 100%; }
.item-weight { max-width: 65px; text-align: center; }
.del-btn { background: #ff3b3015; color:#ff453a; border:none; border-radius:12px; cursor:pointer; padding: 12px; font-weight: bold; }
</style>
</head>
<body class="dark">

<div class="top-buttons">
  <button class="top-btn" id="volBtn" onclick="toggleVolume()">üîä ON</button>
  <button class="top-btn" onclick="toggleDarkMode()">‚òÄÔ∏è</button>
  <button class="top-btn" onclick="toggleSettings()">‚öôÔ∏è Ë®≠ÂÆö</button>
</div>

<div class="main-wrapper">
  <div class="container">
    <div id="result-display">READY</div>
    <div class="roulette-wrapper">
      <div class="pointer"></div>
      <canvas id="canvas" width="840" height="840"></canvas>
    </div>
    <button class="spin-btn" id="spinBtn" onclick="startSpin()">SPIN</button>
  </div>

  <div class="settings-panel" id="settingsPanel">
    <h2 style="margin:0; font-size: 1.8rem;">Settings</h2>
    <div class="item-list" id="itemList"></div>
    <button class="top-btn" onclick="addItem()" style="background:var(--operator); color:white; width:100%; padding:18px; margin-bottom: 12px; border-radius: 20px;">+ Add Item</button>
    <button class="top-btn" onclick="toggleSettings()" style="width:100%; padding:18px; border-radius: 20px;">Close</button>
  </div>
</div>

<script>
let items = [
  { name: 'Â§ßÂãùÂà©', weight: 1, color: '#ff375f' },
  { name: 'ÂΩì„Åü„Çä', weight: 3, color: '#ff9f0a' },
  { name: 'ÊôÆÈÄö', weight: 8, color: '#30d158' },
  { name: 'ÂæÆÂ¶ô', weight: 5, color: '#0a84ff' },
  { name: '„Éè„Ç∫„É¨', weight: 2, color: '#8e8e93' }
];

let currentRotation = 0;
let isSpinning = false;
let volumeOn = true;
let darkMode = true;
let lastIdx = -1;

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playClickSound() {
  if(!volumeOn) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = 'sine';
  osc.frequency.setValueAtTime(450, audioCtx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(80, audioCtx.currentTime + 0.04);
  gain.gain.setValueAtTime(0.04, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.04);
  osc.connect(gain); gain.connect(audioCtx.destination);
  osc.start(); osc.stop(audioCtx.currentTime + 0.04);
}

function draw() {
  const totalWeight = items.reduce((sum, i) => sum + i.weight, 0);
  let startAngle = currentRotation;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  items.forEach((item) => {
    const sliceAngle = (item.weight / totalWeight) * 2 * Math.PI;
    ctx.beginPath();
    ctx.moveTo(420, 420);
    ctx.arc(420, 420, 410, startAngle, startAngle + sliceAngle);
    ctx.fillStyle = item.color;
    ctx.fill();
    ctx.strokeStyle = 'rgba(0,0,0,0.05)';
    ctx.lineWidth = 1;
    ctx.stroke();

    ctx.save();
    ctx.translate(420, 420);
    ctx.rotate(startAngle + sliceAngle / 2);
    ctx.textAlign = "right";
    ctx.fillStyle = "#fff";
    ctx.font = "bold 34px -apple-system";
    ctx.fillText(item.name, 380, 12);
    ctx.restore();
    startAngle += sliceAngle;
  });
}

function startSpin() {
  if (isSpinning) return;
  if(audioCtx.state === 'suspended') audioCtx.resume();
  isSpinning = true;
  document.getElementById('spinBtn').disabled = true;
  document.getElementById('result-display').innerText = "SPINNING...";

  const totalWeight = items.reduce((sum, i) => sum + i.weight, 0);
  
  // ÂàùÈÄü„Çí‰∏ä„Åí„ÄÅÊë©Êì¶„ÇíÊ•µÈôê„Åæ„ÅßÂ∞è„Åï„Åè„Åó„Å¶Ë∂Ö„É≠„É≥„Ç∞„Çπ„Éî„É≥„Å´
  let velocity = 0.3 + Math.random() * 0.2; 
  const friction = 0.9975; 

  function animate() {
    currentRotation += velocity;
    velocity *= friction;

    let checkAngle = (1.5 * Math.PI - (currentRotation % (2 * Math.PI))) % (2 * Math.PI);
    if(checkAngle < 0) checkAngle += 2 * Math.PI;
    
    let currentIdx = 0;
    let acc = 0;
    for(let i=0; i<items.length; i++) {
      acc += (items[i].weight / totalWeight) * 2 * Math.PI;
      if(checkAngle < acc) { currentIdx = i; break; }
    }

    if(currentIdx !== lastIdx) {
      playClickSound();
      lastIdx = currentIdx;
    }

    draw();

    if (velocity > 0.0001) {
      requestAnimationFrame(animate);
    } else {
      isSpinning = false;
      document.getElementById('spinBtn').disabled = false;
      document.getElementById('result-display').innerText = items[lastIdx].name;
    }
  }
  animate();
}

function toggleSettings() {
  const panel = document.getElementById('settingsPanel');
  panel.classList.toggle('open');
  if(panel.classList.contains('open')) renderSettings();
}

function renderSettings() {
  const list = document.getElementById('itemList');
  list.innerHTML = '';
  items.forEach((item, index) => {
    const row = document.createElement('div');
    row.className = 'item-row';
    row.innerHTML = `
      <input type="text" value="${item.name}" onchange="updateItem(${index}, 'name', this.value)">
      <input type="number" class="item-weight" value="${item.weight}" min="1" onchange="updateItem(${index}, 'weight', this.value)">
      <button class="del-btn" onclick="removeItem(${index})">‚úï</button>
    `;
    list.appendChild(row);
  });
}

function updateItem(index, key, value) {
  if(key === 'weight') items[index][key] = Math.max(1, parseInt(value) || 1);
  else items[index][key] = value;
  draw();
}

function addItem() {
  const colors = ['#ff375f', '#ff9f0a', '#30d158', '#0a84ff', '#bf5af2', '#64d2ff'];
  items.push({ name: 'New Item', weight: 1, color: colors[items.length % colors.length] });
  renderSettings();
  draw();
}

function removeItem(index) {
  if(items.length > 2) {
    items.splice(index, 1);
    renderSettings();
    draw();
  }
}

function toggleVolume() { 
  volumeOn = !volumeOn;
  document.getElementById('volBtn').innerText = volumeOn ? 'üîä ON' : 'üîá OFF';
}
function toggleDarkMode() {
  darkMode = !darkMode;
  document.body.classList.toggle('dark', darkMode);
}

draw();
</script>
</body>
</html>